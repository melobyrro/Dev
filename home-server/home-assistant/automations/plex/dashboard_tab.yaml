title: Plex Priority Dashboard
views:
  - title: Plex Priority
    path: plex-priority
    icon: mdi:plex
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            title: Plex Dynamic Priority
            content: >
              **Control resource allocation when Plex is active.**

              Lower niceness = Higher priority.

              Class 1 (Realtime) > Class 2 (Best Effort) > Class 3 (Idle).
          - type: entities
            title: Service Control
            show_header_toggle: false
            entities:
              - entity: input_boolean.plex_priority_enabled
                name: Enable Optimization
          - type: entities
            title: CPU Priority (Niceness)
            show_header_toggle: false
            entities:
              - entity: input_number.plex_niceness
                name: Plex Priority (-20 to 19)
              - entity: input_number.qbit_niceness
                name: Torrent Throttling (-20 to 19)
          - type: grid
            columns: 2
            square: false
            cards:
              - type: entities
                title: Plex I/O
                entities:
                  - entity: input_select.plex_io_class
                    name: Class
              - type: entities
                title: qBittorrent I/O
                entities:
                  - entity: input_select.qbit_io_class
                    name: Class
          - type: button
            name: Force Sync Configuration
            icon: mdi:sync
            show_name: true
            tap_action:
              action: call-service
              service: shell_command.update_plex_priority_config
          - type: markdown
            title: Service Log
            content: |
              ```text
              {{ state_attr('sensor.plex_priority_log', 'log_content') }}
              ```
          - type: markdown
            title: How it Works
            content: >
              ### üß† **The Logic**

              This automation monitors **Plex**. When a stream starts (Active), it automatically re-allocates system resources to prevent buffering. When the stream stops (Idle), it restores balance.


              ### üéõÔ∏è **Controls Reference**

              **1. Service Control**

              *   **Enable Optimization:** Master switch. If OFF, no automatic changes happen.


              **2. CPU Priority (Niceness)**

              *   Values range from **-20** (Highest Priority) to **19** (Lowest Priority).

              *   **Plex (-5):** "VIP" status. It cuts in line for CPU time.

              *   **Torrents (10):** "Background" status. It only runs when the CPU is free.


              **3. Disk I/O Class**

              *   **Realtime (1):** Dangerous. First access to disk.

              *   **Best Effort (2):** Standard default.

              *   **Idle (3):** Polite. Only reads/writes when the disk is completely silent. **Ideal for Torrents.**


              ### üí° **Usage Examples**

              **"No Buffering Mode" (Recommended)**

              *   Plex Priority: **-5** (High)

              *   Torrent Throttling: **15** (Very Low)

              *   Torrent I/O: **Idle (3)** (Stops torrents during heavy playback)


              **"Balanced Mode"**

              *   Plex Priority: **0** (Normal)

              *   Torrent Throttling: **5** (Slightly Lower)

              *   Torrent I/O: **Best Effort (2)** (Torrents continue but might slow down Plex)
          - type: markdown
            title: How it Works
            content: >
              ### üß† **The Logic**

              This automation monitors **Plex**. When a stream starts (Active), it automatically re-allocates system resources to prevent buffering. When the stream stops (Idle), it restores balance.


              ### üéõÔ∏è **Controls Reference**

              **1. Service Control**

              *   **Enable Optimization:** Master switch. If OFF, no automatic changes happen.


              **2. CPU Priority (Niceness)**

              *   Values range from **-20** (Highest Priority) to **19** (Lowest Priority).

              *   **Plex (-5):** "VIP" status. It cuts in line for CPU time.

              *   **Torrents (10):** "Background" status. It only runs when the CPU is free.


              **3. Disk I/O Class**

              *   **Realtime (1):** Dangerous. First access to disk.

              *   **Best Effort (2):** Standard default.

              *   **Idle (3):** Polite. Only reads/writes when the disk is completely silent. **Ideal for Torrents.**


              ### üí° **Usage Examples**

              **"No Buffering Mode" (Recommended)**

              *   Plex Priority: **-5** (High)

              *   Torrent Throttling: **15** (Very Low)

              *   Torrent I/O: **Idle (3)** (Stops torrents during heavy playback)


              **"Balanced Mode"**

              *   Plex Priority: **0** (Normal)

              *   Torrent Throttling: **5** (Slightly Lower)

              *   Torrent I/O: **Best Effort (2)** (Torrents continue but might slow down Plex)
