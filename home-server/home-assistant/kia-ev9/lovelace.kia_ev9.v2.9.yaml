views:
- title: Main
  path: main
  icon: mdi:car-electric
  cards:
  - type: vertical-stack
    cards:
    - type: horizontal-stack
      cards:
      - type: gauge
        entity: sensor.ev9_ev_battery_level
        name: Battery
        min: 0
        max: 100
        severity:
          green: 50
          yellow: 20
          red: 10
        needle: true
      - type: vertical-stack
        cards:
        - type: entity
          entity: sensor.ev9_ev_range
          name: Range
          icon: mdi:road-variant
        - type: entity
          entity: sensor.ev9_car_battery_level
          name: 12V Battery
          icon: mdi:car-battery
  - type: conditional
    conditions:
    - condition: state
      entity: binary_sensor.ev9_ev_battery_plug
      state: 'on'
    card:
      type: vertical-stack
      cards:
      - type: markdown
        content: '## Charging Status'
      - type: horizontal-stack
        cards:
        - type: entity
          entity: sensor.ev9_ev_charging_power
          name: Power
          icon: mdi:flash
          unit: kW
        - type: custom:button-card
          entity: sensor.ev9_estimated_charge_duration
          name: Time Left
          icon: mdi:timer-outline
          show_state: true
          show_icon: true
          show_name: true
          layout: vertical
          styles:
            card:
            - padding: 12px
            state:
            - font-size: 18px
            - font-weight: bold
          state_display: "[[[\n  var mins = parseInt(entity.state) || 0;\n  var h\
            \ = Math.floor(mins / 60);\n  var m = mins % 60;\n  return (h < 10 ? '0'\
            \ : '') + h + ':' + (m < 10 ? '0' : '') + m;\n]]]\n"
      - type: entities
        entities:
        - entity: binary_sensor.ev9_ev_battery_charge
          name: Charging Active
        - entity: number.ev9_ac_charging_limit
          name: AC Limit
        - entity: number.ev9_dc_charging_limit
          name: DC Limit
  - type: vertical-stack
    cards:
    - type: markdown
      content: '## Climate Control'
    - type: entities
      entities:
      - entity: input_number.ev9_target_temperature
        name: Target Temperature
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        name: Start Climate
        icon: mdi:air-conditioner
        tap_action:
          action: call-service
          service: script.ev9_start_climate_with_timer
        styles:
          card:
          - background-color: var(--primary-color)
          - color: white
          icon:
          - color: white
      - type: custom:button-card
        name: Stop Climate
        icon: mdi:fan-off
        tap_action:
          action: call-service
          service: script.ev9_stop_climate_cancel_timer
        styles:
          card:
          - background-color: var(--error-color)
          - color: white
          icon:
          - color: white
    - type: entities
      entities:
      - entity: binary_sensor.ev9_air_conditioner
        name: Climate Active
      - entity: timer.ev9_climate_timer
        name: Auto-Stop Timer
      - entity: input_number.ev9_climate_duration
        name: Duration
  - type: vertical-stack
    cards:
    - type: markdown
      content: '## Vehicle Security'
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: lock.ev9_door_lock
        name: Lock
        icon: mdi:lock
        tap_action:
          action: call-service
          service: lock.lock
          service_data:
            entity_id: lock.ev9_door_lock
        styles:
          card:
          - background-color: var(--success-color)
          - color: white
          - flex: 1
          icon:
          - color: white
      - type: custom:button-card
        entity: lock.ev9_door_lock
        name: Unlock
        icon: mdi:lock-open
        tap_action:
          action: call-service
          service: lock.unlock
          service_data:
            entity_id: lock.ev9_door_lock
          confirmation:
            text: Unlock the vehicle?
        styles:
          card:
          - background-color: var(--warning-color)
          - color: white
          - flex: 1
          icon:
          - color: white
      - type: custom:button-card
        entity: lock.ev9_door_lock
        show_name: false
        show_icon: true
        show_state: true
        icon: "[[[\n  return entity.state === 'locked' ? 'mdi:shield-lock' : 'mdi:shield-lock-open-outline';\n\
          ]]]\n"
        styles:
          card:
          - flex: 1.5
          - padding: 8px
          state:
          - font-size: 14px
          - font-weight: bold
          - text-transform: capitalize
          icon:
          - color: "[[[\n  return entity.state === 'locked' ? 'var(--success-color)'\
              \ : 'var(--warning-color)';\n]]]\n"
    - type: markdown
      content: "**Doors:**\n{% set doors = [\n  ('FL', states('binary_sensor.ev9_front_left_door')),\n\
        \  ('FR', states('binary_sensor.ev9_front_right_door')),\n  ('BL', states('binary_sensor.ev9_back_left_door')),\n\
        \  ('BR', states('binary_sensor.ev9_back_right_door')),\n  ('Trunk', states('binary_sensor.ev9_trunk')),\n\
        \  ('Hood', states('binary_sensor.ev9_hood'))\n] %}\n{% for name, state in\
        \ doors %}{% if state == 'off' %}<font color=\"green\">{{ name }}✓</font>{%\
        \ else %}<font color=\"red\">{{ name }}⚠</font>{% endif %}  {% endfor %}\n"
    - type: markdown
      content: '**Walk-Away:** {% if is_state(''input_boolean.ev9_walk_away_lock_enabled'',
        ''on'') %}<font color="green">ON</font>{% else %}<font color="gray">OFF</font>{%
        endif %} ({{ states(''input_number.ev9_walkaway_distance'') | int }}m threshold)

        *Last: {{ states(''input_text.ev9_last_walkaway_result'') | default(''unknown'',
        true) }}*


        **Timeout:** {% if is_state(''input_boolean.ev9_timeout_lock_enabled'', ''on'')
        %}<font color="green">ON</font>{% else %}<font color="gray">OFF</font>{% endif
        %} ({{ states(''input_number.ev9_unlock_timeout'') | int }}min)

        *Last: {{ states(''input_text.ev9_last_timeout_lock_result'') | default(''unknown'',
        true) }}*

        '
  - type: vertical-stack
    cards:
    - type: markdown
      content: '## Car Status'
    - type: entities
      entities:
      - entity: sensor.ev9_car_mode
        name: Mode
      - entity: binary_sensor.ev9_air_conditioner
        name: Climate System
      - entity: sensor.ev9_set_temperature
        name: Set Temperature
      - entity: binary_sensor.ev9_engine
        name: Engine/Motor
      - entity: binary_sensor.ev9_defrost
        name: Defrost
      - entity: binary_sensor.ev9_steering_wheel_heater
        name: Steering Heater
      - entity: binary_sensor.ev9_back_window_heater
        name: Rear Defroster
      - entity: binary_sensor.ev9_side_mirror_heater
        name: Mirror Heaters
  - type: entities
    title: Vehicle Info
    entities:
    - entity: sensor.ev9_odometer
      name: Odometer
    - entity: sensor.ev9_last_updated_at
      name: Last Update
      format: relative
  - type: map
    entities:
    - entity: device_tracker.ev9_location
    dark_mode: true
    default_zoom: 15
    aspect_ratio: '16:9'
- title: Climate
  path: climate
  icon: mdi:thermostat
  cards:
  - type: vertical-stack
    cards:
    - type: markdown
      content: '## Car Status'
    - type: entities
      entities:
      - entity: sensor.ev9_car_mode
        name: Mode
      - entity: binary_sensor.ev9_air_conditioner
        name: Climate System
      - entity: sensor.ev9_set_temperature
        name: Set Temperature
      - entity: binary_sensor.ev9_engine
        name: Engine/Motor
      - entity: binary_sensor.ev9_defrost
        name: Defrost
      - entity: binary_sensor.ev9_steering_wheel_heater
        name: Steering Heater
      - entity: binary_sensor.ev9_back_window_heater
        name: Rear Defroster
      - entity: binary_sensor.ev9_side_mirror_heater
        name: Mirror Heaters
  - type: vertical-stack
    cards:
    - type: markdown
      content: '## Pre-conditioning Settings'
    - type: entities
      show_header_toggle: false
      entities:
      - entity: input_boolean.ev9_smart_precondition
        name: Smart Mode (Weather-Based)
      - entity: input_number.ev9_evaluation_window
        name: Evaluation Window (min)
    - type: markdown
      content: '**Outside Temp**: {{ state_attr(''weather.forecast_home'', ''temperature'')
        | default(''--'') }}F


        *Smart Mode calculates runtime as: |target - outside| x rate (min/°F)*

        '
  - type: vertical-stack
    cards:
    - type: markdown
      content: '### Schedule 1'
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_enabled
        show_name: false
        show_state: false
        icon: mdi:power
        styles:
          card:
          - width: 40px
          - height: 40px
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            icon:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: var(--disabled-color)
        tap_action:
          action: toggle
      - type: entity
        entity: input_datetime.ev9_schedule_1_time
        name: Time
      - type: entity
        entity: input_number.ev9_schedule_1_temperature
        name: Temp
    - type: entities
      entities:
      - entity: input_number.ev9_schedule_1_rate
        name: Smart Rate (min/°F)
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_mon
        name: M
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_tue
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_wed
        name: W
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_thu
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_fri
        name: F
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_sat
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_1_sun
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
    - type: markdown
      content: '**Next Eval:** {{ states(''sensor.ev9_schedule_1_next_eval'') }} |
        **Climate Start:** {{ states(''sensor.ev9_schedule_1_climate_start'') }}'
    - type: conditional
      conditions:
      - condition: state
        entity: input_boolean.ev9_schedule_1_enabled
        state: 'on'
      card:
        type: markdown
        content: '**Calculation Debug:**

          - Outside Temp: {{ state_attr(''weather.forecast_home'', ''temperature'')
          | default(''--'') }}°F

          - Target Temp: {{ states(''input_number.ev9_schedule_1_temperature'') }}°F

          - Temp Diff: {{ ((states(''input_number.ev9_schedule_1_temperature'') |
          float(72) - state_attr(''weather.forecast_home'', ''temperature'') | float(72))
          | abs) | round(1) }}°F

          - Rate: {{ states(''input_number.ev9_schedule_1_rate'') }} min/°F

          - Runtime: {{ (((states(''input_number.ev9_schedule_1_temperature'') | float(72)
          - state_attr(''weather.forecast_home'', ''temperature'') | float(72)) |
          abs) * states(''input_number.ev9_schedule_1_rate'') | float(1)) | round(0)
          }} min

          - Departure: {{ states(''input_datetime.ev9_schedule_1_time'') }}

          - Eval Window: {{ states(''input_number.ev9_evaluation_window'') }} min'
  - type: vertical-stack
    cards:
    - type: markdown
      content: '### Schedule 2'
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_enabled
        show_name: false
        show_state: false
        icon: mdi:power
        styles:
          card:
          - width: 40px
          - height: 40px
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            icon:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: var(--disabled-color)
        tap_action:
          action: toggle
      - type: entity
        entity: input_datetime.ev9_schedule_2_time
        name: Time
      - type: entity
        entity: input_number.ev9_schedule_2_temperature
        name: Temp
    - type: entities
      entities:
      - entity: input_number.ev9_schedule_2_rate
        name: Smart Rate (min/°F)
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_mon
        name: M
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_tue
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_wed
        name: W
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_thu
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_fri
        name: F
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_sat
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_2_sun
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
    - type: markdown
      content: '**Next Eval:** {{ states(''sensor.ev9_schedule_2_next_eval'') }} |
        **Climate Start:** {{ states(''sensor.ev9_schedule_2_climate_start'') }}'
    - type: conditional
      conditions:
      - condition: state
        entity: input_boolean.ev9_schedule_2_enabled
        state: 'on'
      card:
        type: markdown
        content: '**Calculation Debug:**

          - Outside Temp: {{ state_attr(''weather.forecast_home'', ''temperature'')
          | default(''--'') }}°F

          - Target Temp: {{ states(''input_number.ev9_schedule_2_temperature'') }}°F

          - Temp Diff: {{ ((states(''input_number.ev9_schedule_2_temperature'') |
          float(72) - state_attr(''weather.forecast_home'', ''temperature'') | float(72))
          | abs) | round(1) }}°F

          - Rate: {{ states(''input_number.ev9_schedule_2_rate'') }} min/°F

          - Runtime: {{ (((states(''input_number.ev9_schedule_2_temperature'') | float(72)
          - state_attr(''weather.forecast_home'', ''temperature'') | float(72)) |
          abs) * states(''input_number.ev9_schedule_2_rate'') | float(1)) | round(0)
          }} min

          - Departure: {{ states(''input_datetime.ev9_schedule_2_time'') }}

          - Eval Window: {{ states(''input_number.ev9_evaluation_window'') }} min'
  - type: vertical-stack
    cards:
    - type: markdown
      content: '### Schedule 3'
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_enabled
        show_name: false
        show_state: false
        icon: mdi:power
        styles:
          card:
          - width: 40px
          - height: 40px
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            icon:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: var(--disabled-color)
        tap_action:
          action: toggle
      - type: entity
        entity: input_datetime.ev9_schedule_3_time
        name: Time
      - type: entity
        entity: input_number.ev9_schedule_3_temperature
        name: Temp
    - type: entities
      entities:
      - entity: input_number.ev9_schedule_3_rate
        name: Smart Rate (min/°F)
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_mon
        name: M
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_tue
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_wed
        name: W
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_thu
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_fri
        name: F
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_sat
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_3_sun
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
    - type: markdown
      content: '**Next Eval:** {{ states(''sensor.ev9_schedule_3_next_eval'') }} |
        **Climate Start:** {{ states(''sensor.ev9_schedule_3_climate_start'') }}'
    - type: conditional
      conditions:
      - condition: state
        entity: input_boolean.ev9_schedule_3_enabled
        state: 'on'
      card:
        type: markdown
        content: '**Calculation Debug:**

          - Outside Temp: {{ state_attr(''weather.forecast_home'', ''temperature'')
          | default(''--'') }}°F

          - Target Temp: {{ states(''input_number.ev9_schedule_3_temperature'') }}°F

          - Temp Diff: {{ ((states(''input_number.ev9_schedule_3_temperature'') |
          float(72) - state_attr(''weather.forecast_home'', ''temperature'') | float(72))
          | abs) | round(1) }}°F

          - Rate: {{ states(''input_number.ev9_schedule_3_rate'') }} min/°F

          - Runtime: {{ (((states(''input_number.ev9_schedule_3_temperature'') | float(72)
          - state_attr(''weather.forecast_home'', ''temperature'') | float(72)) |
          abs) * states(''input_number.ev9_schedule_3_rate'') | float(1)) | round(0)
          }} min

          - Departure: {{ states(''input_datetime.ev9_schedule_3_time'') }}

          - Eval Window: {{ states(''input_number.ev9_evaluation_window'') }} min'
  - type: vertical-stack
    cards:
    - type: markdown
      content: '### Schedule 4'
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_enabled
        show_name: false
        show_state: false
        icon: mdi:power
        styles:
          card:
          - width: 40px
          - height: 40px
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            icon:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: var(--disabled-color)
        tap_action:
          action: toggle
      - type: entity
        entity: input_datetime.ev9_schedule_4_time
        name: Time
      - type: entity
        entity: input_number.ev9_schedule_4_temperature
        name: Temp
    - type: entities
      entities:
      - entity: input_number.ev9_schedule_4_rate
        name: Smart Rate (min/°F)
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_mon
        name: M
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_tue
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_wed
        name: W
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_thu
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_fri
        name: F
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_sat
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_4_sun
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
    - type: markdown
      content: '**Next Eval:** {{ states(''sensor.ev9_schedule_4_next_eval'') }} |
        **Climate Start:** {{ states(''sensor.ev9_schedule_4_climate_start'') }}'
    - type: conditional
      conditions:
      - condition: state
        entity: input_boolean.ev9_schedule_4_enabled
        state: 'on'
      card:
        type: markdown
        content: '**Calculation Debug:**

          - Outside Temp: {{ state_attr(''weather.forecast_home'', ''temperature'')
          | default(''--'') }}°F

          - Target Temp: {{ states(''input_number.ev9_schedule_4_temperature'') }}°F

          - Temp Diff: {{ ((states(''input_number.ev9_schedule_4_temperature'') |
          float(72) - state_attr(''weather.forecast_home'', ''temperature'') | float(72))
          | abs) | round(1) }}°F

          - Rate: {{ states(''input_number.ev9_schedule_4_rate'') }} min/°F

          - Runtime: {{ (((states(''input_number.ev9_schedule_4_temperature'') | float(72)
          - state_attr(''weather.forecast_home'', ''temperature'') | float(72)) |
          abs) * states(''input_number.ev9_schedule_4_rate'') | float(1)) | round(0)
          }} min

          - Departure: {{ states(''input_datetime.ev9_schedule_4_time'') }}

          - Eval Window: {{ states(''input_number.ev9_evaluation_window'') }} min'
  - type: vertical-stack
    cards:
    - type: markdown
      content: '### Schedule 5'
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_enabled
        show_name: false
        show_state: false
        icon: mdi:power
        styles:
          card:
          - width: 40px
          - height: 40px
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            icon:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: var(--disabled-color)
        tap_action:
          action: toggle
      - type: entity
        entity: input_datetime.ev9_schedule_5_time
        name: Time
      - type: entity
        entity: input_number.ev9_schedule_5_temperature
        name: Temp
    - type: entities
      entities:
      - entity: input_number.ev9_schedule_5_rate
        name: Smart Rate (min/°F)
    - type: horizontal-stack
      cards:
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_mon
        name: M
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_tue
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_wed
        name: W
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_thu
        name: T
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_fri
        name: F
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_sat
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: input_boolean.ev9_schedule_5_sun
        name: S
        show_state: false
        styles:
          card:
          - width: 32px
          - height: 32px
          - border-radius: 50%
          - font-size: 12px
          name:
          - font-weight: bold
        state:
        - value: 'on'
          styles:
            card:
            - background-color: var(--primary-color)
            name:
            - color: white
        - value: 'off'
          styles:
            card:
            - background-color: transparent
            - border: 1px solid var(--disabled-color)
            name:
            - color: var(--disabled-text-color)
        tap_action:
          action: toggle
    - type: markdown
      content: '**Next Eval:** {{ states(''sensor.ev9_schedule_5_next_eval'') }} |
        **Climate Start:** {{ states(''sensor.ev9_schedule_5_climate_start'') }}'
    - type: conditional
      conditions:
      - condition: state
        entity: input_boolean.ev9_schedule_5_enabled
        state: 'on'
      card:
        type: markdown
        content: '**Calculation Debug:**

          - Outside Temp: {{ state_attr(''weather.forecast_home'', ''temperature'')
          | default(''--'') }}°F

          - Target Temp: {{ states(''input_number.ev9_schedule_5_temperature'') }}°F

          - Temp Diff: {{ ((states(''input_number.ev9_schedule_5_temperature'') |
          float(72) - state_attr(''weather.forecast_home'', ''temperature'') | float(72))
          | abs) | round(1) }}°F

          - Rate: {{ states(''input_number.ev9_schedule_5_rate'') }} min/°F

          - Runtime: {{ (((states(''input_number.ev9_schedule_5_temperature'') | float(72)
          - state_attr(''weather.forecast_home'', ''temperature'') | float(72)) |
          abs) * states(''input_number.ev9_schedule_5_rate'') | float(1)) | round(0)
          }} min

          - Departure: {{ states(''input_datetime.ev9_schedule_5_time'') }}

          - Eval Window: {{ states(''input_number.ev9_evaluation_window'') }} min'
  type: custom:masonry-layout
  layout:
    max_cols: 1
- title: Config
  path: config
  icon: mdi:cog
  cards:
  - type: vertical-stack
    cards:
    - type: markdown
      content: '## Proximity Security'
    - type: entities
      title: Walk-Away Lock
      show_header_toggle: false
      entities:
      - entity: input_boolean.ev9_walk_away_lock_enabled
        name: Enabled
      - entity: input_number.ev9_walkaway_distance
        name: Distance Threshold
      - entity: sensor.ev9_phone_distance
        name: Current Phone Distance
    - type: entities
      title: Timeout Failsafe
      show_header_toggle: false
      entities:
      - entity: input_boolean.ev9_timeout_lock_enabled
        name: Enabled
      - entity: input_number.ev9_unlock_timeout
        name: Timeout Duration
    - type: entities
      title: System Health
      show_header_toggle: false
      entities:
      - entity: input_boolean.ev9_connection_watchdog_enabled
        name: Connection Watchdog
  - type: entities
    title: Charge Settings
    show_header_toggle: false
    entities:
    - entity: number.ev9_ac_charging_limit
      name: AC Charge Limit
    - entity: number.ev9_dc_charging_limit
      name: DC Charge Limit
    - entity: input_number.ev9_expected_charge_power
      name: Expected Power (kW)
    - entity: input_number.ev9_low_power_threshold
      name: Low Power Threshold
  - type: entities
    title: Alerts & Notifications
    show_header_toggle: false
    entities:
    - entity: input_boolean.ev9_notify_charging_complete
      name: Charging Complete
    - entity: input_boolean.ev9_notify_low_battery
      name: Low Battery
    - entity: input_boolean.ev9_notify_charging_interrupted
      name: Charging Interrupted
    - entity: input_boolean.ev9_notify_low_charging_power
      name: Low Charging Power
    - entity: input_boolean.ev9_notify_trunk_open
      name: Trunk Left Open
    - entity: input_boolean.ev9_notify_unlocked_at_home
      name: Unlocked at Home
    - entity: input_boolean.ev9_auto_close_windows_enabled
      name: Window Open Alert
  - type: entities
    title: Alert Thresholds
    show_header_toggle: false
    entities:
    - entity: input_number.ev9_low_battery_threshold
      name: Low Battery Threshold
    - entity: input_number.ev9_charge_interrupt_check_delay
      name: Interrupt Check Delay
    - entity: input_number.ev9_unlocked_alert_delay
      name: Unlocked Alert Delay
    - entity: input_number.ev9_trunk_open_delay
      name: Trunk Alert Delay
    - entity: input_number.ev9_auto_close_windows_delay
      name: Window Alert Delay
  - type: markdown
    title: Automation Health
    content: '**Walk-Away Lock**

      {{ states(''input_text.ev9_last_walkaway_result'') | default(''No events yet'',
      true) }}


      **Timeout Failsafe**

      {{ states(''input_text.ev9_last_timeout_lock_result'') | default(''No events
      yet'', true) }}


      **Pre-conditioning**

      {{ states(''input_text.ev9_last_precondition_result'') | default(''No events
      yet'', true) }}

      '
- title: Logs
  path: logs
  icon: mdi:text-box-multiple-outline
  cards:
  - type: markdown
    title: Last Run Summary
    content: '**Walk-Away Lock**: {{ states(''input_text.ev9_last_walkaway_result'')
      or ''No events yet'' }}


      **Timeout Lock**: {{ states(''input_text.ev9_last_timeout_lock_result'') or
      ''No events yet'' }}


      **Precondition**: {{ states(''input_text.ev9_last_precondition_result'') or
      ''No events yet'' }}

      '
  - type: markdown
    title: Recent Events
    content: "{% set events = [\n  states('input_text.ev9_event_1'),\n  states('input_text.ev9_event_2'),\n\
      \  states('input_text.ev9_event_3'),\n  states('input_text.ev9_event_4'),\n\
      \  states('input_text.ev9_event_5'),\n  states('input_text.ev9_event_6'),\n\
      \  states('input_text.ev9_event_7'),\n  states('input_text.ev9_event_8'),\n\
      \  states('input_text.ev9_event_9'),\n  states('input_text.ev9_event_10')\n\
      ] %}\n{% set filtered = events | reject('eq', '') | reject('eq', 'unknown')\
      \ | reject('eq', 'unavailable') | list %}\n{% if filtered | length == 0 %}\n\
      *No events logged yet.*\n{% else %}\n{% for event in filtered %}\n- {{ event\
      \ }}\n{% endfor %}\n{% endif %}\n"
  - type: custom:button-card
    name: Clear Event Log
    icon: mdi:delete-outline
    tap_action:
      action: call-service
      service: script.ev9_clear_event_log
      confirmation:
        text: Clear all event log entries?
    styles:
      card:
      - background-color: var(--error-color)
      - color: white
      icon:
      - color: white
- title: Logic & Info
  path: logic-info
  icon: mdi:book-open-variant
  cards:
  - type: markdown
    title: Documentation
    content: '## Walk-Away Auto-Lock


      Automatically locks the vehicle when you walk away from it.


      **How it works:**

      - Triggers when your phone''s GPS distance exceeds the configurable threshold
      (1-20m, default 5m)

      - Must meet ALL conditions: vehicle unlocked AND engine off AND walk-away enabled

      - 1-minute delay before triggering to prevent false positives from GPS jitter


      ---


      ## Timeout Failsafe Lock


      Backup auto-lock that triggers if the vehicle stays unlocked too long.


      **How it works:**

      - Triggers when vehicle remains unlocked longer than the timeout period (5-120
      min, default 30 min)

      - Acts as a safety net if walk-away lock doesn''t trigger (e.g., phone left
      in car)


      ---


      ## Pre-Conditioning Smart Mode (v2.7)


      Weather-based climate pre-conditioning with **per-schedule rates**.


      **Formula:**

      ```

      Runtime = |Outside Temp - Target Temp| x Rate (min/°F)

      ```


      **Example (Schedule 1):**

      - Outside temperature: 90°F

      - Target temperature: 70°F

      - Rate: 1.0 min/°F

      - Temperature difference: |90 - 70| = 20°F

      - Runtime: 20 x 1.0 = 20 minutes


      **Evaluation Process:**

      1. Automation evaluates at `schedule_time - evaluation_window`

      2. Reads current outside temperature from weather entity

      3. Computes runtime using **that schedule''s** rate

      4. Calculates start time: `schedule_time - runtime`

      5. Delays until start time, then starts climate

      6. Vehicle reaches target temp at exactly schedule time


      **Configuration (Climate Tab):**

      - Each schedule has its own rate slider (0.5-10.0 min/°F)

      - Global evaluation window (15-60 min)

      - Countdown displays show time until eval and climate start


      ---


      ## Event Log Reference


      **Event format:** `HH:MM - EVENT_TYPE: Details`


      **Event types:**

      - `CHARGING_COMPLETE` - Charge finished

      - `LOW_BATTERY` - Battery below threshold

      - `WALKAWAY_LOCK` - Auto-locked via walk-away

      - `TIMEOUT_LOCK` - Auto-locked via timeout

      - `PRECONDITION_EVAL` - Evaluation triggered

      - `PRECONDITION_START` - Climate started

      - `CLIMATE_STOP` - Climate stopped

      - `WATCHDOG_*` - Connection recovery events

      '
