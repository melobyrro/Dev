# System Health - Single Card Version
# Copy this into any dashboard as a single card
# Location: dashboards/system_health_card.yaml
# Version: 1.0
# Created: 2026-01-24
#
# Requirements:
# - mushroom cards (via HACS)
# - card-mod (optional, for styling)

type: vertical-stack
cards:
  # Header with overall status
  - type: custom:mushroom-template-card
    primary: Integration Health
    secondary: >
      {{ states('sensor.integration_health_summary') | capitalize }}
    icon: mdi:heart-pulse
    icon_color: >
      {% if is_state('sensor.integration_health_summary', 'healthy') %}
        green
      {% elif 'offline' in states('sensor.integration_health_summary') %}
        red
      {% else %}
        orange
      {% endif %}
    badge_icon: >
      {% set offline = state_attr('sensor.integration_health_summary', 'offline_count') | int(0) %}
      {% if offline > 0 %}
        mdi:alert
      {% endif %}
    badge_color: red
    tap_action:
      action: navigate
      navigation_path: /config/integrations

  # Status chips for each integration
  - type: custom:mushroom-chips-card
    alignment: center
    chips:
      # EV9
      - type: template
        icon: mdi:car-electric
        icon_color: >
          {% set s = states('sensor.ev9_integration_status') %}
          {{ 'green' if s == 'online' else ('orange' if s == 'stale' else 'red') }}
        content: "{{ states('sensor.ev9_ev_battery_level') }}%"
        tap_action:
          action: more-info
          entity: sensor.ev9_ev_battery_level

      # Jose
      - type: template
        icon: mdi:robot-vacuum
        icon_color: >
          {% set s = states('sensor.jose_integration_status') %}
          {{ 'green' if s == 'online' else ('orange' if s == 'stale' else 'red') }}
        content: "{{ states('sensor.jose_battery') }}%"
        tap_action:
          action: more-info
          entity: vacuum.jose

      # Daikin
      - type: template
        icon: mdi:air-conditioner
        icon_color: >
          {% set s = states('sensor.daikin_integration_status') %}
          {{ 'green' if s == 'online' else ('orange' if s == 'stale' else 'red') }}
        content: >
          {% set state = states('climate.living_room') %}
          {{ state[:4] if state not in ['unavailable', 'unknown'] else 'off' }}
        tap_action:
          action: more-info
          entity: climate.living_room

      # Patio AC
      - type: template
        icon: mdi:hvac
        icon_color: >
          {% set s = states('sensor.patio_ac_integration_status') %}
          {{ 'green' if s == 'online' else ('orange' if s == 'stale' else 'red') }}
        content: >
          {% set state = states('climate.patio_ac') %}
          {{ state[:4] if state not in ['unavailable', 'unknown'] else 'off' }}
        tap_action:
          action: more-info
          entity: climate.patio_ac

  # Watchdog toggles (collapsible section)
  - type: conditional
    conditions:
      - condition: state
        entity: sensor.integration_health_summary
        state_not: healthy
    card:
      type: custom:mushroom-chips-card
      alignment: center
      chips:
        - type: entity
          entity: input_boolean.ev9_connection_watchdog_enabled
          icon: mdi:shield-car
          tap_action:
            action: toggle
        - type: entity
          entity: input_boolean.ecovacs_recovery_enabled
          icon: mdi:shield-home
          tap_action:
            action: toggle
